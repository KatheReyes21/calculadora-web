<!DOCTYPE html>

<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Web Modular</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Calculadora Web</h1>
            <p>Una calculadora web implementada con Python y muy eficaz</p>
        </header>

```
    <main>
        <div class="calculadora">
            <div class="pantalla">
                <input type="text" id="pantalla" readonly>
                <div id="resultado"></div>
            </div>

            <div class="botones">
                <div class="fila">
                    <button onclick="agregarNumero('7')">7</button>
                    <button onclick="agregarNumero('8')">8</button>
                    <button onclick="agregarNumero('9')">9</button>
                    <button onclick="agregarOperador('/')">/</button>
                    <button onclick="calcularRaiz()">√</button>
                </div>
                <div class="fila">
                    <button onclick="agregarNumero('4')">4</button>
                    <button onclick="agregarNumero('5')">5</button>
                    <button onclick="agregarNumero('6')">6</button>
                    <button onclick="agregarOperador('*')">×</button>
                    <button onclick="calcularPotencia()">x²</button>
                </div>
                <div class="fila">
                    <button onclick="agregarNumero('1')">1</button>
                    <button onclick="agregarNumero('2')">2</button>
                    <button onclick="agregarNumero('3')">3</button>
                    <button onclick="agregarOperador('-')">-</button>
                    <button onclick="calcularPorcentaje()">%</button>
                </div>
                <div class="fila">
                    <button onclick="agregarNumero('0')">0</button>
                    <button onclick="agregarPunto()">.</button>
                    <button onclick="limpiarPantalla()">C</button>
                    <button onclick="agregarOperador('+')">+</button>
                    <button onclick="calcularExpresion()">=</button>
                </div>
            </div>

            <div class="modo-avanzado">
                <h3>Modo Expresión</h3>
                <input type="text" id="expresion" placeholder="Ej: 2 + 3 * (4 - 1)">
                <button onclick="evaluarExpresion()">Evaluar Expresión</button>
            </div>
        </div>
    </main>

    <footer>
        <p>Desarrollado con Python estándar - Sin frameworks</p>
    </footer>
</div>

<script>
    let pantalla = document.getElementById('pantalla');
    let expresionInput = document.getElementById('expresion');
    let resultadoDiv = document.getElementById('resultado');

    function agregarNumero(numero) {
        pantalla.value += numero;
    }

    function agregarPunto() {
        if (!pantalla.value.includes('.')) {
            pantalla.value += pantalla.value === '' ? '0.' : '.';
        }
    }

    function agregarOperador(op) {
        if (pantalla.value !== '') {
            const ultimoCaracter = pantalla.value.slice(-1);
            if (["+", "-", "*", "/"].includes(ultimoCaracter)) {
                pantalla.value = pantalla.value.slice(0, -1) + op;
            } else {
                pantalla.value += ' ' + op + ' ';
            }
        }
    }

    function limpiarPantalla() {
        pantalla.value = '';
        resultadoDiv.textContent = '';
        expresionInput.value = '';
    }

    function calcularExpresion() {
        if (pantalla.value === '') return;
        const expr = pantalla.value;
        enviarCalculo('expresion', '', '', expr);
    }

    function evaluarExpresion() {
        const expresion = expresionInput.value.trim();
        if (expresion === '') {
            resultadoDiv.textContent = 'Error: La expresión no puede estar vacía';
            resultadoDiv.className = 'error';
            return;
        }
        enviarCalculo('expresion', '', '', expresion);
    }

    function calcularRaiz() {
        const numero = pantalla.value;
        if (numero === '') return;
        enviarCalculo('raiz', numero, '', '');
    }

    function calcularPotencia() {
        const base = pantalla.value;
        if (base === '') return;
        enviarCalculo('potencia', base, '2', '');
    }

    function calcularPorcentaje() {
        if (pantalla.value === '') return;
        const partes = pantalla.value.split(' ');
        if (partes.length >= 3) {
            enviarCalculo('porcentaje', partes[0], partes[2], '');
        } else {
            alert('Para calcular porcentaje, ingrese algo como: 50 / 200');
        }
    }

    function enviarCalculo(operacion, num1, num2, expr) {
        const formData = new FormData();
        formData.append('operacion', operacion);
        formData.append('numero1', num1);
        formData.append('numero2', num2);
        formData.append('expresion', expr);

        fetch('/calcular', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.estado === 'exito') {
                resultadoDiv.textContent = `Resultado: ${data.resultado}`;
                resultadoDiv.className = 'exito';
            } else {
                resultadoDiv.textContent = `Error: ${data.mensaje}`;
                resultadoDiv.className = 'error';
            }
        })
        .catch(error => {
            resultadoDiv.textContent = `Error de conexión: ${error}`;
            resultadoDiv.className = 'error';
        });
    }

    document.addEventListener('keydown', function(event) {
        if (event.key >= '0' && event.key <= '9') agregarNumero(event.key);
        else if (event.key === '.') agregarPunto();
        else if (["+", "-", "*", "/"].includes(event.key)) agregarOperador(event.key);
        else if (event.key === 'Enter') calcularExpresion();
        else if (event.key === 'Escape') limpiarPantalla();
    });
</script>
```

</body>
</html>
